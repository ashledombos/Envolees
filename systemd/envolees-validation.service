# Envolées - Validation quotidienne IS/OOS
#
# Pipeline complet avec tolérance par ticker :
# - Les tickers avec des problèmes de cache sont exclus
# - Le pipeline continue avec les tickers éligibles
# - Une alerte est envoyée avec les exclusions
#
# Installation :
#   mkdir -p ~/.config/systemd/user
#   cp systemd/*.service systemd/*.timer ~/.config/systemd/user/
#   systemctl --user daemon-reload
#   systemctl --user enable --now envolees-validation.timer
#
# Logs :
#   journalctl --user -u envolees-validation.service -f

[Unit]
Description=Envolées - Validation quotidienne IS/OOS
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
WorkingDirectory=%h/dev/envolees

# Pipeline complet avec tolérance par ticker
ExecStart=/usr/bin/bash -lc '\
    cd %h/dev/envolees && \
    source .venv/bin/activate && \
    set -a && source .env && source .env.secret 2>/dev/null || true && set +a && \
    python main.py pipeline --alert \
'

# Timeout 30 min (backtests peuvent être longs)
TimeoutStartSec=1800

# Logs vers journal
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=default.target
